import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/components/EditLoanItemModal.tsx");import __vite__cjsImport0_react_jsxDevRuntime from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=8973d617"; const Fragment = __vite__cjsImport0_react_jsxDevRuntime["Fragment"]; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import * as RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.$RefreshReg$) {
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong."
    );
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = RefreshRuntime.getRefreshReg("/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx");
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$();
import __vite__cjsImport3_react from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/react.js?v=8973d617"; const useState = __vite__cjsImport3_react["useState"]; const useEffect = __vite__cjsImport3_react["useEffect"];
import { useMutation, useQueryClient } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/@tanstack_react-query.js?v=27047fab";
import { useForm } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/react-hook-form.js?v=df739c30";
import { zodResolver } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/@hookform_resolvers_zod.js?v=03a768ad";
import { Package, Loader2 } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/lucide-react.js?v=9fe1beea";
import { Button } from "/src/components/ui/button.tsx";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "/src/components/ui/dialog.tsx";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "/src/components/ui/form.tsx";
import { Input } from "/src/components/ui/input.tsx";
import { Textarea } from "/src/components/ui/textarea.tsx";
import { useToast } from "/src/hooks/use-toast.ts";
import { apiRequest, invalidateAndRefetch } from "/src/lib/queryClient.ts";
import { updateLoanItemSchema } from "/@fs/Users/thibault/Développements /CJD80/cjd80/shared/schema.ts";
import { z } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/zod.js?v=ed4c3458";
const editFormSchema = updateLoanItemSchema.extend({
  photoFile: z.instanceof(File).optional().or(z.literal(void 0))
});
export default function EditLoanItemModal({
  open,
  onOpenChange,
  item
}) {
  _s();
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [photoPreview, setPhotoPreview] = useState(null);
  const form = useForm({
    resolver: zodResolver(editFormSchema),
    defaultValues: {
      title: "",
      description: "",
      lenderName: "",
      photoUrl: void 0
    }
  });
  useEffect(() => {
    if (item) {
      form.reset({
        title: item.title,
        description: item.description || "",
        lenderName: item.lenderName,
        photoUrl: item.photoUrl || void 0
      });
      setPhotoPreview(item.photoUrl || null);
    }
  }, [item, form]);
  const updateMutation = useMutation({
    mutationFn: async (data) => {
      const updateData = {
        title: data.title,
        description: data.description || null,
        lenderName: data.lenderName
      };
      await apiRequest("PUT", `/api/admin/loan-items/${item.id}`, updateData);
      if (data.photoFile) {
        const formData = new FormData();
        formData.append("photo", data.photoFile);
        const res = await fetch(`/api/admin/loan-items/${item.id}/photo`, {
          method: "POST",
          body: formData
        });
        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.message || "Erreur lors de l'upload de la photo");
        }
      }
      return { success: true };
    },
    onSuccess: () => {
      invalidateAndRefetch(["/api/admin/loan-items"]);
      invalidateAndRefetch(["/api/loan-items"]);
      toast({
        title: "Matériel mis à jour",
        description: "Les informations ont été modifiées avec succès."
      });
      onOpenChange(false);
      form.reset();
      setPhotoPreview(null);
    },
    onError: (error) => {
      toast({
        title: "Erreur",
        description: error.message,
        variant: "destructive"
      });
    }
  });
  const handlePhotoChange = (e) => {
    const file = e.target.files?.[0];
    if (file) {
      form.setValue("photoFile", file);
      const reader = new FileReader();
      reader.onloadend = () => {
        setPhotoPreview(reader.result);
      };
      reader.readAsDataURL(file);
    }
  };
  const handleSubmit = (data) => {
    updateMutation.mutate(data);
  };
  if (!item) return null;
  return /* @__PURE__ */ jsxDEV(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxDEV(DialogContent, { className: "max-w-2xl max-h-[90vh] overflow-y-auto", children: [
    /* @__PURE__ */ jsxDEV(DialogHeader, { children: [
      /* @__PURE__ */ jsxDEV(DialogTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxDEV(Package, { className: "w-5 h-5" }, void 0, false, {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
          lineNumber: 152,
          columnNumber: 13
        }, this),
        "Modifier le matériel"
      ] }, void 0, true, {
        fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
        lineNumber: 151,
        columnNumber: 11
      }, this),
      /* @__PURE__ */ jsxDEV(DialogDescription, { children: "Modifiez les informations du matériel" }, void 0, false, {
        fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
        lineNumber: 155,
        columnNumber: 11
      }, this)
    ] }, void 0, true, {
      fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
      lineNumber: 150,
      columnNumber: 9
    }, this),
    /* @__PURE__ */ jsxDEV(Form, { ...form, children: /* @__PURE__ */ jsxDEV("form", { onSubmit: form.handleSubmit(handleSubmit), className: "space-y-4", children: [
      /* @__PURE__ */ jsxDEV(
        FormField,
        {
          control: form.control,
          name: "title",
          render: ({ field }) => /* @__PURE__ */ jsxDEV(FormItem, { children: [
            /* @__PURE__ */ jsxDEV(FormLabel, { children: "Titre *" }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 167,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormControl, { children: /* @__PURE__ */ jsxDEV(Input, { placeholder: "Titre du matériel", ...field }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 169,
              columnNumber: 21
            }, this) }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 168,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormMessage, {}, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 171,
              columnNumber: 19
            }, this)
          ] }, void 0, true, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 166,
            columnNumber: 15
          }, this)
        },
        void 0,
        false,
        {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
          lineNumber: 162,
          columnNumber: 13
        },
        this
      ),
      /* @__PURE__ */ jsxDEV(
        FormField,
        {
          control: form.control,
          name: "description",
          render: ({ field }) => /* @__PURE__ */ jsxDEV(FormItem, { children: [
            /* @__PURE__ */ jsxDEV(FormLabel, { children: "Description" }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 181,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormControl, { children: /* @__PURE__ */ jsxDEV(
              Textarea,
              {
                placeholder: "Description du matériel",
                className: "min-h-[100px]",
                ...field,
                value: field.value || ""
              },
              void 0,
              false,
              {
                fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
                lineNumber: 183,
                columnNumber: 21
              },
              this
            ) }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 182,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormMessage, {}, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 190,
              columnNumber: 19
            }, this)
          ] }, void 0, true, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 180,
            columnNumber: 15
          }, this)
        },
        void 0,
        false,
        {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
          lineNumber: 176,
          columnNumber: 13
        },
        this
      ),
      /* @__PURE__ */ jsxDEV(
        FormField,
        {
          control: form.control,
          name: "lenderName",
          render: ({ field }) => /* @__PURE__ */ jsxDEV(FormItem, { children: [
            /* @__PURE__ */ jsxDEV(FormLabel, { children: "Nom du JD qui prête *" }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 200,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormControl, { children: /* @__PURE__ */ jsxDEV(Input, { placeholder: "Nom du JD", ...field }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 202,
              columnNumber: 21
            }, this) }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 201,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormMessage, {}, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 204,
              columnNumber: 19
            }, this)
          ] }, void 0, true, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 199,
            columnNumber: 15
          }, this)
        },
        void 0,
        false,
        {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
          lineNumber: 195,
          columnNumber: 13
        },
        this
      ),
      /* @__PURE__ */ jsxDEV(
        FormField,
        {
          control: form.control,
          name: "photoFile",
          render: ({ field: { value, onChange, ...field } }) => /* @__PURE__ */ jsxDEV(FormItem, { children: [
            /* @__PURE__ */ jsxDEV(FormLabel, { children: "Photo" }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 214,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormControl, { children: /* @__PURE__ */ jsxDEV("div", { className: "space-y-2", children: [
              photoPreview && /* @__PURE__ */ jsxDEV("div", { className: "w-full h-48 bg-gray-100 rounded-lg overflow-hidden", children: /* @__PURE__ */ jsxDEV(
                "img",
                {
                  src: photoPreview,
                  alt: "Preview",
                  className: "w-full h-full object-cover"
                },
                void 0,
                false,
                {
                  fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
                  lineNumber: 219,
                  columnNumber: 27
                },
                this
              ) }, void 0, false, {
                fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
                lineNumber: 218,
                columnNumber: 21
              }, this),
              /* @__PURE__ */ jsxDEV(
                Input,
                {
                  type: "file",
                  accept: "image/*",
                  onChange: (e) => {
                    handlePhotoChange(e);
                    onChange(e.target.files?.[0]);
                  },
                  ...field
                },
                void 0,
                false,
                {
                  fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
                  lineNumber: 226,
                  columnNumber: 23
                },
                this
              )
            ] }, void 0, true, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 216,
              columnNumber: 21
            }, this) }, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 215,
              columnNumber: 19
            }, this),
            /* @__PURE__ */ jsxDEV(FormMessage, {}, void 0, false, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 237,
              columnNumber: 19
            }, this)
          ] }, void 0, true, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 213,
            columnNumber: 15
          }, this)
        },
        void 0,
        false,
        {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
          lineNumber: 209,
          columnNumber: 13
        },
        this
      ),
      /* @__PURE__ */ jsxDEV(DialogFooter, { children: [
        /* @__PURE__ */ jsxDEV(
          Button,
          {
            type: "button",
            variant: "outline",
            onClick: () => {
              onOpenChange(false);
              form.reset();
              setPhotoPreview(null);
            },
            children: "Annuler"
          },
          void 0,
          false,
          {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 243,
            columnNumber: 15
          },
          this
        ),
        /* @__PURE__ */ jsxDEV(
          Button,
          {
            type: "submit",
            className: "bg-cjd-green hover:bg-success-dark",
            disabled: updateMutation.isPending,
            children: updateMutation.isPending ? /* @__PURE__ */ jsxDEV(Fragment, { children: [
              /* @__PURE__ */ jsxDEV(Loader2, { className: "w-4 h-4 mr-2 animate-spin" }, void 0, false, {
                fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
                lineNumber: 261,
                columnNumber: 21
              }, this),
              "Enregistrement..."
            ] }, void 0, true, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
              lineNumber: 260,
              columnNumber: 17
            }, this) : "Enregistrer"
          },
          void 0,
          false,
          {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
            lineNumber: 254,
            columnNumber: 15
          },
          this
        )
      ] }, void 0, true, {
        fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
        lineNumber: 242,
        columnNumber: 13
      }, this)
    ] }, void 0, true, {
      fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
      lineNumber: 161,
      columnNumber: 11
    }, this) }, void 0, false, {
      fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
      lineNumber: 160,
      columnNumber: 9
    }, this)
  ] }, void 0, true, {
    fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
    lineNumber: 149,
    columnNumber: 7
  }, this) }, void 0, false, {
    fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx",
    lineNumber: 148,
    columnNumber: 5
  }, this);
}
_s(EditLoanItemModal, "0D/knakZakMxlX+1ppmlkfDTCRc=", false, function() {
  return [useToast, useQueryClient, useForm, useMutation];
});
_c = EditLoanItemModal;
var _c;
$RefreshReg$(_c, "EditLoanItemModal");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("/Users/thibault/Développements /CJD80/cjd80/client/src/components/EditLoanItemModal.tsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,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QkFBOEM7QUFBQTtBQUFBLGlCQURoRDtBQUFBO0FBQUE7QUFBQTtBQUFBLG1CQUdBLElBRUE7QUFBQTtBQUFBLFVBWEo7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLFFBYUE7QUFBQSxXQXpCRjtBQUFBO0FBQUE7QUFBQTtBQUFBLGFBMEJBO0FBQUEsU0EzR0Y7QUFBQTtBQUFBO0FBQUE7QUFBQSxXQTRHQSxLQTdHRjtBQUFBO0FBQUE7QUFBQTtBQUFBLFdBOEdBO0FBQUEsT0F6SEY7QUFBQTtBQUFBO0FBQUE7QUFBQSxTQTBIQSxLQTNIRjtBQUFBO0FBQUE7QUFBQTtBQUFBLFNBNEhBO0FBRUo7QUFBQ25ELEdBak91QkosbUJBQWlCO0FBQUEsVUFLckJkLFVBQ0VwQixnQkFHUEMsU0FzQlVGLFdBQVc7QUFBQTtBQUFBMkYsS0EvQlp4RDtBQUFpQixJQUFBd0Q7QUFBQUMsYUFBQUQsSUFBQSIsIm5hbWVzIjpbInVzZVN0YXRlIiwidXNlRWZmZWN0IiwidXNlTXV0YXRpb24iLCJ1c2VRdWVyeUNsaWVudCIsInVzZUZvcm0iLCJ6b2RSZXNvbHZlciIsIlBhY2thZ2UiLCJMb2FkZXIyIiwiQnV0dG9uIiwiRGlhbG9nIiwiRGlhbG9nQ29udGVudCIsIkRpYWxvZ0Rlc2NyaXB0aW9uIiwiRGlhbG9nRm9vdGVyIiwiRGlhbG9nSGVhZGVyIiwiRGlhbG9nVGl0bGUiLCJGb3JtIiwiRm9ybUNvbnRyb2wiLCJGb3JtRmllbGQiLCJGb3JtSXRlbSIsIkZvcm1MYWJlbCIsIkZvcm1NZXNzYWdlIiwiSW5wdXQiLCJUZXh0YXJlYSIsInVzZVRvYXN0IiwiYXBpUmVxdWVzdCIsImludmFsaWRhdGVBbmRSZWZldGNoIiwidXBkYXRlTG9hbkl0ZW1TY2hlbWEiLCJ6IiwiZWRpdEZvcm1TY2hlbWEiLCJleHRlbmQiLCJwaG90b0ZpbGUiLCJpbnN0YW5jZW9mIiwiRmlsZSIsIm9wdGlvbmFsIiwib3IiLCJsaXRlcmFsIiwidW5kZWZpbmVkIiwiRWRpdExvYW5JdGVtTW9kYWwiLCJvcGVuIiwib25PcGVuQ2hhbmdlIiwiaXRlbSIsIl9zIiwidG9hc3QiLCJxdWVyeUNsaWVudCIsInBob3RvUHJldmlldyIsInNldFBob3RvUHJldmlldyIsImZvcm0iLCJyZXNvbHZlciIsImRlZmF1bHRWYWx1ZXMiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwibGVuZGVyTmFtZSIsInBob3RvVXJsIiwicmVzZXQiLCJ1cGRhdGVNdXRhdGlvbiIsIm11dGF0aW9uRm4iLCJkYXRhIiwidXBkYXRlRGF0YSIsImlkIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsInJlcyIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsIm9rIiwiZXJyb3IiLCJqc29uIiwiRXJyb3IiLCJtZXNzYWdlIiwic3VjY2VzcyIsIm9uU3VjY2VzcyIsIm9uRXJyb3IiLCJ2YXJpYW50IiwiaGFuZGxlUGhvdG9DaGFuZ2UiLCJlIiwiZmlsZSIsInRhcmdldCIsImZpbGVzIiwic2V0VmFsdWUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkZW5kIiwicmVzdWx0IiwicmVhZEFzRGF0YVVSTCIsImhhbmRsZVN1Ym1pdCIsIm11dGF0ZSIsImNvbnRyb2wiLCJmaWVsZCIsInZhbHVlIiwib25DaGFuZ2UiLCJpc1BlbmRpbmciLCJfYyIsIiRSZWZyZXNoUmVnJCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJFZGl0TG9hbkl0ZW1Nb2RhbC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlTXV0YXRpb24sIHVzZVF1ZXJ5Q2xpZW50IH0gZnJvbSBcIkB0YW5zdGFjay9yZWFjdC1xdWVyeVwiO1xuaW1wb3J0IHsgdXNlRm9ybSB9IGZyb20gXCJyZWFjdC1ob29rLWZvcm1cIjtcbmltcG9ydCB7IHpvZFJlc29sdmVyIH0gZnJvbSBcIkBob29rZm9ybS9yZXNvbHZlcnMvem9kXCI7XG5pbXBvcnQgeyBQYWNrYWdlLCBVcGxvYWQsIExvYWRlcjIgfSBmcm9tIFwibHVjaWRlLXJlYWN0XCI7XG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2J1dHRvblwiO1xuaW1wb3J0IHsgRGlhbG9nLCBEaWFsb2dDb250ZW50LCBEaWFsb2dEZXNjcmlwdGlvbiwgRGlhbG9nRm9vdGVyLCBEaWFsb2dIZWFkZXIsIERpYWxvZ1RpdGxlIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9kaWFsb2dcIjtcbmltcG9ydCB7IEZvcm0sIEZvcm1Db250cm9sLCBGb3JtRmllbGQsIEZvcm1JdGVtLCBGb3JtTGFiZWwsIEZvcm1NZXNzYWdlIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9mb3JtXCI7XG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvaW5wdXRcIjtcbmltcG9ydCB7IFRleHRhcmVhIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS90ZXh0YXJlYVwiO1xuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tIFwiQC9ob29rcy91c2UtdG9hc3RcIjtcbmltcG9ydCB7IGFwaVJlcXVlc3QsIGludmFsaWRhdGVBbmRSZWZldGNoIH0gZnJvbSBcIkAvbGliL3F1ZXJ5Q2xpZW50XCI7XG5pbXBvcnQgeyB1cGRhdGVMb2FuSXRlbVNjaGVtYSwgdHlwZSBMb2FuSXRlbSB9IGZyb20gXCJAc2hhcmVkL3NjaGVtYVwiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcblxuaW50ZXJmYWNlIEVkaXRMb2FuSXRlbU1vZGFsUHJvcHMge1xuICBvcGVuOiBib29sZWFuO1xuICBvbk9wZW5DaGFuZ2U6IChvcGVuOiBib29sZWFuKSA9PiB2b2lkO1xuICBpdGVtOiBMb2FuSXRlbSB8IG51bGw7XG59XG5cbmNvbnN0IGVkaXRGb3JtU2NoZW1hID0gdXBkYXRlTG9hbkl0ZW1TY2hlbWEuZXh0ZW5kKHtcbiAgcGhvdG9GaWxlOiB6Lmluc3RhbmNlb2YoRmlsZSkub3B0aW9uYWwoKS5vcih6LmxpdGVyYWwodW5kZWZpbmVkKSksXG59KTtcblxudHlwZSBFZGl0TG9hbkl0ZW1Gb3JtID0gei5pbmZlcjx0eXBlb2YgZWRpdEZvcm1TY2hlbWE+ICYge1xuICBwaG90b0ZpbGU/OiBGaWxlO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gRWRpdExvYW5JdGVtTW9kYWwoeyBcbiAgb3BlbiwgXG4gIG9uT3BlbkNoYW5nZSwgXG4gIGl0ZW0gXG59OiBFZGl0TG9hbkl0ZW1Nb2RhbFByb3BzKSB7XG4gIGNvbnN0IHsgdG9hc3QgfSA9IHVzZVRvYXN0KCk7XG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gdXNlUXVlcnlDbGllbnQoKTtcbiAgY29uc3QgW3Bob3RvUHJldmlldywgc2V0UGhvdG9QcmV2aWV3XSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuXG4gIGNvbnN0IGZvcm0gPSB1c2VGb3JtPEVkaXRMb2FuSXRlbUZvcm0+KHtcbiAgICByZXNvbHZlcjogem9kUmVzb2x2ZXIoZWRpdEZvcm1TY2hlbWEpLFxuICAgIGRlZmF1bHRWYWx1ZXM6IHtcbiAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgZGVzY3JpcHRpb246IFwiXCIsXG4gICAgICBsZW5kZXJOYW1lOiBcIlwiLFxuICAgICAgcGhvdG9Vcmw6IHVuZGVmaW5lZCxcbiAgICB9XG4gIH0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGl0ZW0pIHtcbiAgICAgIGZvcm0ucmVzZXQoe1xuICAgICAgICB0aXRsZTogaXRlbS50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGl0ZW0uZGVzY3JpcHRpb24gfHwgXCJcIixcbiAgICAgICAgbGVuZGVyTmFtZTogaXRlbS5sZW5kZXJOYW1lLFxuICAgICAgICBwaG90b1VybDogaXRlbS5waG90b1VybCB8fCB1bmRlZmluZWQsXG4gICAgICB9KTtcbiAgICAgIHNldFBob3RvUHJldmlldyhpdGVtLnBob3RvVXJsIHx8IG51bGwpO1xuICAgIH1cbiAgfSwgW2l0ZW0sIGZvcm1dKTtcblxuICBjb25zdCB1cGRhdGVNdXRhdGlvbiA9IHVzZU11dGF0aW9uKHtcbiAgICBtdXRhdGlvbkZuOiBhc3luYyAoZGF0YTogRWRpdExvYW5JdGVtRm9ybSkgPT4ge1xuICAgICAgLy8gRCdhYm9yZCBtZXR0cmUgw6Agam91ciBsZXMgY2hhbXBzIHRleHRlXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XG4gICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbiB8fCBudWxsLFxuICAgICAgICBsZW5kZXJOYW1lOiBkYXRhLmxlbmRlck5hbWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBhcGlSZXF1ZXN0KFwiUFVUXCIsIGAvYXBpL2FkbWluL2xvYW4taXRlbXMvJHtpdGVtIS5pZH1gLCB1cGRhdGVEYXRhKTtcblxuICAgICAgLy8gRW5zdWl0ZSB1cGxvYWRlciBsYSBwaG90byBzaSBmb3VybmllXG4gICAgICBpZiAoZGF0YS5waG90b0ZpbGUpIHtcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwicGhvdG9cIiwgZGF0YS5waG90b0ZpbGUpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYC9hcGkvYWRtaW4vbG9hbi1pdGVtcy8ke2l0ZW0hLmlkfS9waG90b2AsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcmVzLm9rKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXMuanNvbigpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlIHx8IFwiRXJyZXVyIGxvcnMgZGUgbCd1cGxvYWQgZGUgbGEgcGhvdG9cIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0sXG4gICAgb25TdWNjZXNzOiAoKSA9PiB7XG4gICAgICBpbnZhbGlkYXRlQW5kUmVmZXRjaChbXCIvYXBpL2FkbWluL2xvYW4taXRlbXNcIl0pO1xuICAgICAgaW52YWxpZGF0ZUFuZFJlZmV0Y2goW1wiL2FwaS9sb2FuLWl0ZW1zXCJdKTtcbiAgICAgIHRvYXN0KHtcbiAgICAgICAgdGl0bGU6IFwiTWF0w6lyaWVsIG1pcyDDoCBqb3VyXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkxlcyBpbmZvcm1hdGlvbnMgb250IMOpdMOpIG1vZGlmacOpZXMgYXZlYyBzdWNjw6hzLlwiLFxuICAgICAgfSk7XG4gICAgICBvbk9wZW5DaGFuZ2UoZmFsc2UpO1xuICAgICAgZm9ybS5yZXNldCgpO1xuICAgICAgc2V0UGhvdG9QcmV2aWV3KG51bGwpO1xuICAgIH0sXG4gICAgb25FcnJvcjogKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgdG9hc3Qoe1xuICAgICAgICB0aXRsZTogXCJFcnJldXJcIixcbiAgICAgICAgZGVzY3JpcHRpb246IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGhhbmRsZVBob3RvQ2hhbmdlID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzPy5bMF07XG4gICAgaWYgKGZpbGUpIHtcbiAgICAgIGZvcm0uc2V0VmFsdWUoXCJwaG90b0ZpbGVcIiwgZmlsZSk7XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9ICgpID0+IHtcbiAgICAgICAgc2V0UGhvdG9QcmV2aWV3KHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nKTtcbiAgICAgIH07XG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlU3VibWl0ID0gKGRhdGE6IEVkaXRMb2FuSXRlbUZvcm0pID0+IHtcbiAgICB1cGRhdGVNdXRhdGlvbi5tdXRhdGUoZGF0YSk7XG4gIH07XG5cbiAgaWYgKCFpdGVtKSByZXR1cm4gbnVsbDtcblxuICByZXR1cm4gKFxuICAgIDxEaWFsb2cgb3Blbj17b3Blbn0gb25PcGVuQ2hhbmdlPXtvbk9wZW5DaGFuZ2V9PlxuICAgICAgPERpYWxvZ0NvbnRlbnQgY2xhc3NOYW1lPVwibWF4LXctMnhsIG1heC1oLVs5MHZoXSBvdmVyZmxvdy15LWF1dG9cIj5cbiAgICAgICAgPERpYWxvZ0hlYWRlcj5cbiAgICAgICAgICA8RGlhbG9nVGl0bGUgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTJcIj5cbiAgICAgICAgICAgIDxQYWNrYWdlIGNsYXNzTmFtZT1cInctNSBoLTVcIiAvPlxuICAgICAgICAgICAgTW9kaWZpZXIgbGUgbWF0w6lyaWVsXG4gICAgICAgICAgPC9EaWFsb2dUaXRsZT5cbiAgICAgICAgICA8RGlhbG9nRGVzY3JpcHRpb24+XG4gICAgICAgICAgICBNb2RpZmlleiBsZXMgaW5mb3JtYXRpb25zIGR1IG1hdMOpcmllbFxuICAgICAgICAgIDwvRGlhbG9nRGVzY3JpcHRpb24+XG4gICAgICAgIDwvRGlhbG9nSGVhZGVyPlxuXG4gICAgICAgIDxGb3JtIHsuLi5mb3JtfT5cbiAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17Zm9ybS5oYW5kbGVTdWJtaXQoaGFuZGxlU3VibWl0KX0gY2xhc3NOYW1lPVwic3BhY2UteS00XCI+XG4gICAgICAgICAgICA8Rm9ybUZpZWxkXG4gICAgICAgICAgICAgIGNvbnRyb2w9e2Zvcm0uY29udHJvbH1cbiAgICAgICAgICAgICAgbmFtZT1cInRpdGxlXCJcbiAgICAgICAgICAgICAgcmVuZGVyPXsoeyBmaWVsZCB9KSA9PiAoXG4gICAgICAgICAgICAgICAgPEZvcm1JdGVtPlxuICAgICAgICAgICAgICAgICAgPEZvcm1MYWJlbD5UaXRyZSAqPC9Gb3JtTGFiZWw+XG4gICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgICAgIDxJbnB1dCBwbGFjZWhvbGRlcj1cIlRpdHJlIGR1IG1hdMOpcmllbFwiIHsuLi5maWVsZH0gLz5cbiAgICAgICAgICAgICAgICAgIDwvRm9ybUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgICA8Rm9ybU1lc3NhZ2UgLz5cbiAgICAgICAgICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgPEZvcm1GaWVsZFxuICAgICAgICAgICAgICBjb250cm9sPXtmb3JtLmNvbnRyb2x9XG4gICAgICAgICAgICAgIG5hbWU9XCJkZXNjcmlwdGlvblwiXG4gICAgICAgICAgICAgIHJlbmRlcj17KHsgZmllbGQgfSkgPT4gKFxuICAgICAgICAgICAgICAgIDxGb3JtSXRlbT5cbiAgICAgICAgICAgICAgICAgIDxGb3JtTGFiZWw+RGVzY3JpcHRpb248L0Zvcm1MYWJlbD5cbiAgICAgICAgICAgICAgICAgIDxGb3JtQ29udHJvbD5cbiAgICAgICAgICAgICAgICAgICAgPFRleHRhcmVhXG4gICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJEZXNjcmlwdGlvbiBkdSBtYXTDqXJpZWxcIlxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1pbi1oLVsxMDBweF1cIlxuICAgICAgICAgICAgICAgICAgICAgIHsuLi5maWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ZmllbGQudmFsdWUgfHwgXCJcIn1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgIDwvRm9ybUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgICA8Rm9ybU1lc3NhZ2UgLz5cbiAgICAgICAgICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgPEZvcm1GaWVsZFxuICAgICAgICAgICAgICBjb250cm9sPXtmb3JtLmNvbnRyb2x9XG4gICAgICAgICAgICAgIG5hbWU9XCJsZW5kZXJOYW1lXCJcbiAgICAgICAgICAgICAgcmVuZGVyPXsoeyBmaWVsZCB9KSA9PiAoXG4gICAgICAgICAgICAgICAgPEZvcm1JdGVtPlxuICAgICAgICAgICAgICAgICAgPEZvcm1MYWJlbD5Ob20gZHUgSkQgcXVpIHByw6p0ZSAqPC9Gb3JtTGFiZWw+XG4gICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgICAgIDxJbnB1dCBwbGFjZWhvbGRlcj1cIk5vbSBkdSBKRFwiIHsuLi5maWVsZH0gLz5cbiAgICAgICAgICAgICAgICAgIDwvRm9ybUNvbnRyb2w+XG4gICAgICAgICAgICAgICAgICA8Rm9ybU1lc3NhZ2UgLz5cbiAgICAgICAgICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgPEZvcm1GaWVsZFxuICAgICAgICAgICAgICBjb250cm9sPXtmb3JtLmNvbnRyb2x9XG4gICAgICAgICAgICAgIG5hbWU9XCJwaG90b0ZpbGVcIlxuICAgICAgICAgICAgICByZW5kZXI9eyh7IGZpZWxkOiB7IHZhbHVlLCBvbkNoYW5nZSwgLi4uZmllbGQgfSB9KSA9PiAoXG4gICAgICAgICAgICAgICAgPEZvcm1JdGVtPlxuICAgICAgICAgICAgICAgICAgPEZvcm1MYWJlbD5QaG90bzwvRm9ybUxhYmVsPlxuICAgICAgICAgICAgICAgICAgPEZvcm1Db250cm9sPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktMlwiPlxuICAgICAgICAgICAgICAgICAgICAgIHtwaG90b1ByZXZpZXcgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3LWZ1bGwgaC00OCBiZy1ncmF5LTEwMCByb3VuZGVkLWxnIG92ZXJmbG93LWhpZGRlblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtwaG90b1ByZXZpZXd9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PVwiUHJldmlld1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwidy1mdWxsIGgtZnVsbCBvYmplY3QtY292ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJmaWxlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdD1cImltYWdlLypcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVBob3RvQ2hhbmdlKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZShlLnRhcmdldC5maWxlcz8uWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICB7Li4uZmllbGR9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8L0Zvcm1Db250cm9sPlxuICAgICAgICAgICAgICAgICAgPEZvcm1NZXNzYWdlIC8+XG4gICAgICAgICAgICAgICAgPC9Gb3JtSXRlbT5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgIDxEaWFsb2dGb290ZXI+XG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICB2YXJpYW50PVwib3V0bGluZVwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgb25PcGVuQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIGZvcm0ucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgIHNldFBob3RvUHJldmlldyhudWxsKTtcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgQW5udWxlclxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHR5cGU9XCJzdWJtaXRcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImJnLWNqZC1ncmVlbiBob3ZlcjpiZy1zdWNjZXNzLWRhcmtcIlxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXt1cGRhdGVNdXRhdGlvbi5pc1BlbmRpbmd9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7dXBkYXRlTXV0YXRpb24uaXNQZW5kaW5nID8gKFxuICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgPExvYWRlcjIgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yIGFuaW1hdGUtc3BpblwiIC8+XG4gICAgICAgICAgICAgICAgICAgIEVucmVnaXN0cmVtZW50Li4uXG4gICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgXCJFbnJlZ2lzdHJlclwiXG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8L0RpYWxvZ0Zvb3Rlcj5cbiAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvRm9ybT5cbiAgICAgIDwvRGlhbG9nQ29udGVudD5cbiAgICA8L0RpYWxvZz5cbiAgKTtcbn1cblxuIl0sImZpbGUiOiIvVXNlcnMvdGhpYmF1bHQvRGXMgXZlbG9wcGVtZW50cyAvQ0pEODAvY2pkODAvY2xpZW50L3NyYy9jb21wb25lbnRzL0VkaXRMb2FuSXRlbU1vZGFsLnRzeCJ9