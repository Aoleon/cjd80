import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/components/offline-status-banner.tsx");import __vite__cjsImport0_react_jsxDevRuntime from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=8973d617"; const Fragment = __vite__cjsImport0_react_jsxDevRuntime["Fragment"]; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import * as RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.$RefreshReg$) {
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong."
    );
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = RefreshRuntime.getRefreshReg("/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx");
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$();
import __vite__cjsImport3_react from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/react.js?v=8973d617"; const useState = __vite__cjsImport3_react["useState"]; const useEffect = __vite__cjsImport3_react["useEffect"];
import { Wifi, WifiOff, Loader2 } from "/@fs/Users/thibault/Développements /CJD80/cjd80/node_modules/.vite/deps/lucide-react.js?v=9fe1beea";
import { Button } from "/src/components/ui/button.tsx";
import { useToast } from "/src/hooks/use-toast.ts";
import { offlineQueue } from "/src/lib/offline-queue.ts";
import { syncQueuedActions } from "/src/lib/sync-service.ts";
export default function OfflineStatusBanner() {
  _s();
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [actionCount, setActionCount] = useState(0);
  const [isSyncing, setIsSyncing] = useState(false);
  const { toast } = useToast();
  useEffect(() => {
    const handleOnline = () => {
      console.log("[OfflineStatusBanner] Connection restored");
      setIsOnline(true);
    };
    const handleOffline = () => {
      console.log("[OfflineStatusBanner] Connection lost");
      setIsOnline(false);
    };
    const handleSyncComplete = (event) => {
      const customEvent = event;
      const { synced, failed } = customEvent.detail;
      console.log("[OfflineStatusBanner] Sync complete:", { synced, failed });
      if (synced > 0) {
        toast({
          title: "Synchronisation réussie",
          description: `${synced} action${synced > 1 ? "s" : ""} synchronisée${synced > 1 ? "s" : ""} avec succès`,
          variant: "default"
        });
      }
      updateActionCount();
    };
    const handleSyncFailed = (event) => {
      const customEvent = event;
      const { failed } = customEvent.detail;
      console.log("[OfflineStatusBanner] Sync failed:", { failed });
      toast({
        title: "Erreur de synchronisation",
        description: `${failed} action${failed > 1 ? "s" : ""} n'ont pas pu être synchronisée${failed > 1 ? "s" : ""}`,
        variant: "destructive"
      });
      updateActionCount();
    };
    window.addEventListener("online", handleOnline);
    window.addEventListener("offline", handleOffline);
    window.addEventListener("sync-complete", handleSyncComplete);
    window.addEventListener("sync-failed", handleSyncFailed);
    return () => {
      window.removeEventListener("online", handleOnline);
      window.removeEventListener("offline", handleOffline);
      window.removeEventListener("sync-complete", handleSyncComplete);
      window.removeEventListener("sync-failed", handleSyncFailed);
    };
  }, [toast]);
  useEffect(() => {
    updateActionCount();
    const interval = setInterval(() => {
      updateActionCount();
    }, 2e3);
    return () => clearInterval(interval);
  }, []);
  const updateActionCount = async () => {
    try {
      const count = await offlineQueue.getCount();
      setActionCount(count);
    } catch (error) {
      console.error("[OfflineStatusBanner] Failed to get action count:", error);
    }
  };
  const handleSync = async () => {
    if (!isOnline) {
      toast({
        title: "Impossible de synchroniser",
        description: "Vous devez être en ligne pour synchroniser les actions",
        variant: "destructive"
      });
      return;
    }
    setIsSyncing(true);
    try {
      const result = await syncQueuedActions();
      if (result.synced > 0) {
        toast({
          title: "Synchronisation réussie",
          description: `${result.synced} action${result.synced > 1 ? "s" : ""} synchronisée${result.synced > 1 ? "s" : ""} avec succès`,
          variant: "default"
        });
      }
      if (result.failed > 0) {
        toast({
          title: "Synchronisation partielle",
          description: `${result.failed} action${result.failed > 1 ? "s" : ""} n'ont pas pu être synchronisée${result.failed > 1 ? "s" : ""}`,
          variant: "destructive"
        });
      }
      if (result.synced === 0 && result.failed === 0) {
        toast({
          title: "Aucune action à synchroniser",
          description: "Toutes les actions sont déjà synchronisées",
          variant: "default"
        });
      }
      await updateActionCount();
    } catch (error) {
      console.error("[OfflineStatusBanner] Sync error:", error);
      toast({
        title: "Erreur de synchronisation",
        description: "Une erreur est survenue lors de la synchronisation",
        variant: "destructive"
      });
    } finally {
      setIsSyncing(false);
    }
  };
  if (isOnline && actionCount === 0) {
    return null;
  }
  const bgColor = !isOnline ? "bg-warning dark:bg-warning-dark" : "bg-info dark:bg-info-dark";
  const Icon = isOnline ? Wifi : WifiOff;
  const message = !isOnline ? `Mode hors ligne - ${actionCount} action${actionCount > 1 ? "s" : ""} en attente` : `${actionCount} action${actionCount > 1 ? "s" : ""} en attente de synchronisation`;
  return /* @__PURE__ */ jsxDEV(
    "div",
    {
      "data-testid": "banner-offline-status",
      className: `fixed top-0 left-0 right-0 z-50 ${bgColor} text-white shadow-lg animate-in slide-in-from-top duration-300`,
      children: /* @__PURE__ */ jsxDEV("div", { className: "container mx-auto px-4 py-3", children: /* @__PURE__ */ jsxDEV("div", { className: "flex items-center justify-between gap-4 flex-wrap", children: [
        /* @__PURE__ */ jsxDEV("div", { className: "flex items-center gap-3", children: [
          /* @__PURE__ */ jsxDEV(Icon, { className: "h-5 w-5 flex-shrink-0", "data-testid": "icon-connection-status" }, void 0, false, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
            lineNumber: 182,
            columnNumber: 13
          }, this),
          /* @__PURE__ */ jsxDEV("span", { className: "text-sm font-medium", "data-testid": "text-status-message", children: message }, void 0, false, {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
            lineNumber: 183,
            columnNumber: 13
          }, this)
        ] }, void 0, true, {
          fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
          lineNumber: 181,
          columnNumber: 11
        }, this),
        /* @__PURE__ */ jsxDEV(
          Button,
          {
            onClick: handleSync,
            disabled: !isOnline || isSyncing || actionCount === 0,
            variant: "secondary",
            size: "sm",
            className: "flex items-center gap-2",
            "data-testid": "button-sync-now",
            children: isSyncing ? /* @__PURE__ */ jsxDEV(Fragment, { children: [
              /* @__PURE__ */ jsxDEV(Loader2, { className: "h-4 w-4 animate-spin", "data-testid": "icon-syncing" }, void 0, false, {
                fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
                lineNumber: 198,
                columnNumber: 17
              }, this),
              "Synchronisation..."
            ] }, void 0, true, {
              fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
              lineNumber: 197,
              columnNumber: 13
            }, this) : "Synchroniser maintenant"
          },
          void 0,
          false,
          {
            fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
            lineNumber: 188,
            columnNumber: 11
          },
          this
        )
      ] }, void 0, true, {
        fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
        lineNumber: 180,
        columnNumber: 9
      }, this) }, void 0, false, {
        fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
        lineNumber: 179,
        columnNumber: 7
      }, this)
    },
    void 0,
    false,
    {
      fileName: "/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx",
      lineNumber: 175,
      columnNumber: 5
    },
    this
  );
}
_s(OfflineStatusBanner, "IdVKeBolYILN9mCGemirm/rf9Vk=", false, function() {
  return [useToast];
});
_c = OfflineStatusBanner;
var _c;
$RefreshReg$(_c, "OfflineStatusBanner");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("/Users/thibault/Développements /CJD80/cjd80/client/src/components/offline-status-banner.tsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,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O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxRQWdCQTtBQUFBLFdBeEJGO0FBQUE7QUFBQTtBQUFBO0FBQUEsYUF5QkEsS0ExQkY7QUFBQTtBQUFBO0FBQUE7QUFBQSxhQTJCQTtBQUFBO0FBQUEsSUEvQkY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBZ0NBO0FBRUo7QUFBQ1AsR0F0THVCRCxxQkFBbUI7QUFBQSxVQUl2QkgsUUFBUTtBQUFBO0FBQUEyQyxLQUpKeEM7QUFBbUIsSUFBQXdDO0FBQUFDLGFBQUFELElBQUEiLCJuYW1lcyI6WyJ1c2VTdGF0ZSIsInVzZUVmZmVjdCIsIldpZmkiLCJXaWZpT2ZmIiwiTG9hZGVyMiIsIkJ1dHRvbiIsInVzZVRvYXN0Iiwib2ZmbGluZVF1ZXVlIiwic3luY1F1ZXVlZEFjdGlvbnMiLCJPZmZsaW5lU3RhdHVzQmFubmVyIiwiX3MiLCJpc09ubGluZSIsInNldElzT25saW5lIiwibmF2aWdhdG9yIiwib25MaW5lIiwiYWN0aW9uQ291bnQiLCJzZXRBY3Rpb25Db3VudCIsImlzU3luY2luZyIsInNldElzU3luY2luZyIsInRvYXN0IiwiaGFuZGxlT25saW5lIiwiY29uc29sZSIsImxvZyIsImhhbmRsZU9mZmxpbmUiLCJoYW5kbGVTeW5jQ29tcGxldGUiLCJldmVudCIsImN1c3RvbUV2ZW50Iiwic3luY2VkIiwiZmFpbGVkIiwiZGV0YWlsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInZhcmlhbnQiLCJ1cGRhdGVBY3Rpb25Db3VudCIsImhhbmRsZVN5bmNGYWlsZWQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiY291bnQiLCJnZXRDb3VudCIsImVycm9yIiwiaGFuZGxlU3luYyIsInJlc3VsdCIsImJnQ29sb3IiLCJJY29uIiwibWVzc2FnZSIsIl9jIiwiJFJlZnJlc2hSZWckIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbIm9mZmxpbmUtc3RhdHVzLWJhbm5lci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgV2lmaSwgV2lmaU9mZiwgTG9hZGVyMiB9IGZyb20gXCJsdWNpZGUtcmVhY3RcIjtcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvYnV0dG9uXCI7XG5pbXBvcnQgeyB1c2VUb2FzdCB9IGZyb20gXCJAL2hvb2tzL3VzZS10b2FzdFwiO1xuaW1wb3J0IHsgb2ZmbGluZVF1ZXVlIH0gZnJvbSBcIkAvbGliL29mZmxpbmUtcXVldWVcIjtcbmltcG9ydCB7IHN5bmNRdWV1ZWRBY3Rpb25zIH0gZnJvbSBcIkAvbGliL3N5bmMtc2VydmljZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBPZmZsaW5lU3RhdHVzQmFubmVyKCkge1xuICBjb25zdCBbaXNPbmxpbmUsIHNldElzT25saW5lXSA9IHVzZVN0YXRlKG5hdmlnYXRvci5vbkxpbmUpO1xuICBjb25zdCBbYWN0aW9uQ291bnQsIHNldEFjdGlvbkNvdW50XSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbaXNTeW5jaW5nLCBzZXRJc1N5bmNpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCB7IHRvYXN0IH0gPSB1c2VUb2FzdCgpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlT25saW5lID0gKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1tPZmZsaW5lU3RhdHVzQmFubmVyXSBDb25uZWN0aW9uIHJlc3RvcmVkJyk7XG4gICAgICBzZXRJc09ubGluZSh0cnVlKTtcbiAgICB9O1xuXG4gICAgY29uc3QgaGFuZGxlT2ZmbGluZSA9ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbT2ZmbGluZVN0YXR1c0Jhbm5lcl0gQ29ubmVjdGlvbiBsb3N0Jyk7XG4gICAgICBzZXRJc09ubGluZShmYWxzZSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZVN5bmNDb21wbGV0ZSA9IChldmVudDogRXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbUV2ZW50ID0gZXZlbnQgYXMgQ3VzdG9tRXZlbnQ8eyBzeW5jZWQ6IG51bWJlcjsgZmFpbGVkOiBudW1iZXIgfT47XG4gICAgICBjb25zdCB7IHN5bmNlZCwgZmFpbGVkIH0gPSBjdXN0b21FdmVudC5kZXRhaWw7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdbT2ZmbGluZVN0YXR1c0Jhbm5lcl0gU3luYyBjb21wbGV0ZTonLCB7IHN5bmNlZCwgZmFpbGVkIH0pO1xuICAgICAgXG4gICAgICBpZiAoc3luY2VkID4gMCkge1xuICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgdGl0bGU6IFwiU3luY2hyb25pc2F0aW9uIHLDqXVzc2llXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGAke3N5bmNlZH0gYWN0aW9uJHtzeW5jZWQgPiAxID8gJ3MnIDogJyd9IHN5bmNocm9uaXPDqWUke3N5bmNlZCA+IDEgPyAncycgOiAnJ30gYXZlYyBzdWNjw6hzYCxcbiAgICAgICAgICB2YXJpYW50OiBcImRlZmF1bHRcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHVwZGF0ZUFjdGlvbkNvdW50KCk7XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZVN5bmNGYWlsZWQgPSAoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21FdmVudCA9IGV2ZW50IGFzIEN1c3RvbUV2ZW50PHsgZmFpbGVkOiBudW1iZXIgfT47XG4gICAgICBjb25zdCB7IGZhaWxlZCB9ID0gY3VzdG9tRXZlbnQuZGV0YWlsO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnW09mZmxpbmVTdGF0dXNCYW5uZXJdIFN5bmMgZmFpbGVkOicsIHsgZmFpbGVkIH0pO1xuICAgICAgXG4gICAgICB0b2FzdCh7XG4gICAgICAgIHRpdGxlOiBcIkVycmV1ciBkZSBzeW5jaHJvbmlzYXRpb25cIixcbiAgICAgICAgZGVzY3JpcHRpb246IGAke2ZhaWxlZH0gYWN0aW9uJHtmYWlsZWQgPiAxID8gJ3MnIDogJyd9IG4nb250IHBhcyBwdSDDqnRyZSBzeW5jaHJvbmlzw6llJHtmYWlsZWQgPiAxID8gJ3MnIDogJyd9YCxcbiAgICAgICAgdmFyaWFudDogXCJkZXN0cnVjdGl2ZVwiLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHVwZGF0ZUFjdGlvbkNvdW50KCk7XG4gICAgfTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBoYW5kbGVPbmxpbmUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgaGFuZGxlT2ZmbGluZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N5bmMtY29tcGxldGUnLCBoYW5kbGVTeW5jQ29tcGxldGUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzeW5jLWZhaWxlZCcsIGhhbmRsZVN5bmNGYWlsZWQpO1xuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBoYW5kbGVPbmxpbmUpO1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCBoYW5kbGVPZmZsaW5lKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzeW5jLWNvbXBsZXRlJywgaGFuZGxlU3luY0NvbXBsZXRlKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzeW5jLWZhaWxlZCcsIGhhbmRsZVN5bmNGYWlsZWQpO1xuICAgIH07XG4gIH0sIFt0b2FzdF0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgdXBkYXRlQWN0aW9uQ291bnQoKTtcblxuICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdXBkYXRlQWN0aW9uQ291bnQoKTtcbiAgICB9LCAyMDAwKTtcblxuICAgIHJldHVybiAoKSA9PiBjbGVhckludGVydmFsKGludGVydmFsKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IHVwZGF0ZUFjdGlvbkNvdW50ID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb3VudCA9IGF3YWl0IG9mZmxpbmVRdWV1ZS5nZXRDb3VudCgpO1xuICAgICAgc2V0QWN0aW9uQ291bnQoY291bnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbT2ZmbGluZVN0YXR1c0Jhbm5lcl0gRmFpbGVkIHRvIGdldCBhY3Rpb24gY291bnQ6JywgZXJyb3IpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoYW5kbGVTeW5jID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghaXNPbmxpbmUpIHtcbiAgICAgIHRvYXN0KHtcbiAgICAgICAgdGl0bGU6IFwiSW1wb3NzaWJsZSBkZSBzeW5jaHJvbmlzZXJcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiVm91cyBkZXZleiDDqnRyZSBlbiBsaWduZSBwb3VyIHN5bmNocm9uaXNlciBsZXMgYWN0aW9uc1wiLFxuICAgICAgICB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzZXRJc1N5bmNpbmcodHJ1ZSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3luY1F1ZXVlZEFjdGlvbnMoKTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5zeW5jZWQgPiAwKSB7XG4gICAgICAgIHRvYXN0KHtcbiAgICAgICAgICB0aXRsZTogXCJTeW5jaHJvbmlzYXRpb24gcsOpdXNzaWVcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7cmVzdWx0LnN5bmNlZH0gYWN0aW9uJHtyZXN1bHQuc3luY2VkID4gMSA/ICdzJyA6ICcnfSBzeW5jaHJvbmlzw6llJHtyZXN1bHQuc3luY2VkID4gMSA/ICdzJyA6ICcnfSBhdmVjIHN1Y2PDqHNgLFxuICAgICAgICAgIHZhcmlhbnQ6IFwiZGVmYXVsdFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5mYWlsZWQgPiAwKSB7XG4gICAgICAgIHRvYXN0KHtcbiAgICAgICAgICB0aXRsZTogXCJTeW5jaHJvbmlzYXRpb24gcGFydGllbGxlXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGAke3Jlc3VsdC5mYWlsZWR9IGFjdGlvbiR7cmVzdWx0LmZhaWxlZCA+IDEgPyAncycgOiAnJ30gbidvbnQgcGFzIHB1IMOqdHJlIHN5bmNocm9uaXPDqWUke3Jlc3VsdC5mYWlsZWQgPiAxID8gJ3MnIDogJyd9YCxcbiAgICAgICAgICB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnN5bmNlZCA9PT0gMCAmJiByZXN1bHQuZmFpbGVkID09PSAwKSB7XG4gICAgICAgIHRvYXN0KHtcbiAgICAgICAgICB0aXRsZTogXCJBdWN1bmUgYWN0aW9uIMOgIHN5bmNocm9uaXNlclwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRvdXRlcyBsZXMgYWN0aW9ucyBzb250IGTDqWrDoCBzeW5jaHJvbmlzw6llc1wiLFxuICAgICAgICAgIHZhcmlhbnQ6IFwiZGVmYXVsdFwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgYXdhaXQgdXBkYXRlQWN0aW9uQ291bnQoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW09mZmxpbmVTdGF0dXNCYW5uZXJdIFN5bmMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgdG9hc3Qoe1xuICAgICAgICB0aXRsZTogXCJFcnJldXIgZGUgc3luY2hyb25pc2F0aW9uXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIlVuZSBlcnJldXIgZXN0IHN1cnZlbnVlIGxvcnMgZGUgbGEgc3luY2hyb25pc2F0aW9uXCIsXG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICAgIH0pO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc1N5bmNpbmcoZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICBpZiAoaXNPbmxpbmUgJiYgYWN0aW9uQ291bnQgPT09IDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGJnQ29sb3IgPSAhaXNPbmxpbmUgXG4gICAgPyBcImJnLXdhcm5pbmcgZGFyazpiZy13YXJuaW5nLWRhcmtcIiBcbiAgICA6IFwiYmctaW5mbyBkYXJrOmJnLWluZm8tZGFya1wiO1xuICBcbiAgY29uc3QgSWNvbiA9IGlzT25saW5lID8gV2lmaSA6IFdpZmlPZmY7XG4gIFxuICBjb25zdCBtZXNzYWdlID0gIWlzT25saW5lXG4gICAgPyBgTW9kZSBob3JzIGxpZ25lIC0gJHthY3Rpb25Db3VudH0gYWN0aW9uJHthY3Rpb25Db3VudCA+IDEgPyAncycgOiAnJ30gZW4gYXR0ZW50ZWBcbiAgICA6IGAke2FjdGlvbkNvdW50fSBhY3Rpb24ke2FjdGlvbkNvdW50ID4gMSA/ICdzJyA6ICcnfSBlbiBhdHRlbnRlIGRlIHN5bmNocm9uaXNhdGlvbmA7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBkYXRhLXRlc3RpZD1cImJhbm5lci1vZmZsaW5lLXN0YXR1c1wiXG4gICAgICBjbGFzc05hbWU9e2BmaXhlZCB0b3AtMCBsZWZ0LTAgcmlnaHQtMCB6LTUwICR7YmdDb2xvcn0gdGV4dC13aGl0ZSBzaGFkb3ctbGcgYW5pbWF0ZS1pbiBzbGlkZS1pbi1mcm9tLXRvcCBkdXJhdGlvbi0zMDBgfVxuICAgID5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyIG14LWF1dG8gcHgtNCBweS0zXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC00IGZsZXgtd3JhcFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTNcIj5cbiAgICAgICAgICAgIDxJY29uIGNsYXNzTmFtZT1cImgtNSB3LTUgZmxleC1zaHJpbmstMFwiIGRhdGEtdGVzdGlkPVwiaWNvbi1jb25uZWN0aW9uLXN0YXR1c1wiIC8+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LXNtIGZvbnQtbWVkaXVtXCIgZGF0YS10ZXN0aWQ9XCJ0ZXh0LXN0YXR1cy1tZXNzYWdlXCI+XG4gICAgICAgICAgICAgIHttZXNzYWdlfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIFxuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVN5bmN9XG4gICAgICAgICAgICBkaXNhYmxlZD17IWlzT25saW5lIHx8IGlzU3luY2luZyB8fCBhY3Rpb25Db3VudCA9PT0gMH1cbiAgICAgICAgICAgIHZhcmlhbnQ9XCJzZWNvbmRhcnlcIlxuICAgICAgICAgICAgc2l6ZT1cInNtXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0yXCJcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLXN5bmMtbm93XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aXNTeW5jaW5nID8gKFxuICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgIDxMb2FkZXIyIGNsYXNzTmFtZT1cImgtNCB3LTQgYW5pbWF0ZS1zcGluXCIgZGF0YS10ZXN0aWQ9XCJpY29uLXN5bmNpbmdcIiAvPlxuICAgICAgICAgICAgICAgIFN5bmNocm9uaXNhdGlvbi4uLlxuICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgIFwiU3luY2hyb25pc2VyIG1haW50ZW5hbnRcIlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn1cbiJdLCJmaWxlIjoiL1VzZXJzL3RoaWJhdWx0L0RlzIF2ZWxvcHBlbWVudHMgL0NKRDgwL2NqZDgwL2NsaWVudC9zcmMvY29tcG9uZW50cy9vZmZsaW5lLXN0YXR1cy1iYW5uZXIudHN4In0=